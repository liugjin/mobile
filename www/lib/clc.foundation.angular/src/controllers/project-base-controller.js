if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);function o(){this.constructor=t}return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},__indexOf=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};define(["./project-item-model-controller"],function(t){var e,r,o;return e="_all",{ProjectBaseController:r=function(t){function r(t,e,o,n,i,u,s,c,p,l){this.modelEngine=c,r.__super__.constructor.call(this,t,e,o,n,i,u,s,p,l),this.starService=this.modelManager.getService("star"),this.$rootScope.myproject={user:this.$routeParams.user,project:this.$routeParams.project}}return __extends(r,t),r.prototype.dispose=function(){return r.__super__.dispose.apply(this,arguments),this.$rootScope.myproject=null},r.prototype.onLoad=function(t,e){return this.loadMyProject((r=this,function(o,n){return o?"function"==typeof t?t(o,n):void 0:r.load(t,e)}),e);var r},r.prototype.loadMyProject=function(t,e){var r,o,n,i;return(r={user:this.$routeParams.user,project:this.$routeParams.project}).project?(o=this.$rootScope.project,!e&&o&&o.user===r.user&&o.project===r.project?(this.project=o,"function"==typeof t?t(null,o):void 0):(n=this.modelManager.getService("project")).get(r,(i=this,function(e,r){return i.$rootScope.project=i.project=r,i.$rootScope.role=i.role=null!=r?r._role:void 0,i.modelEngine.storage.set("myproject",r),i.authenticateMyProject(e,r,t)}),e)):"function"==typeof t?t("未知项目: "+r.user+"/"+r.project):void 0},r.prototype.authenticateMyProject=function(t,r,o){var n,i,u,s,c,p,l,a,f,d,h,j;return j=this,i=function(t){return j.$rootScope.project=j.project=null,j.$rootScope.role=j.role=null,j.display(t),j.goto("/401"),"function"==typeof o&&o(t,r),!1},u=function(e){return function(){return e.accessModule(e.options.module)?("function"==typeof o&&o(null,r),!0):(t="用户"+e.$rootScope.user.user+"未授权访问模块"+e.options.module,e.display(t),e.goto("/401"),void("function"==typeof o&&o(t,r)))}}(this),t?i(t):r?(p=null!=(a=this.$rootScope.user)?a.user:void 0)?"admin"===p||p===r.user?u():(s=null!=(n=this.getRootModule())?n.name:void 0,c=null!=(f=null!=(d=this.role)?d.services:void 0)?f:[],s&&c[0]!==e&&__indexOf.call(c,s)<0?i("登录用户["+p+"]未授权服务["+s+"]"):(l=null!=(h=this.role)?h.users:void 0)?l[0]===e?u():__indexOf.call(l,p)<0?i("用户["+p+"]未授权项目["+this.$routeParams.user+"/"+this.$routeParams.project+"]"):u():i("项目角色未定义！")):i("用户未登录！"):i("项目["+this.$routeParams.user+"/"+this.$routeParams.project+"]加载失败！")},r.prototype.star=function(t,e){var r,o,n;if(null==e&&(e=!0),t)return r={user:t.user,project:t.project,projectName:t.name,starUser:this.$rootScope.user.user,starUserName:this.$rootScope.user.name,remove:!e},o=this.starService.getUrl(r),this.starService.postData(o,r,(n=this,function(r,o){return(null!=o?o.user:void 0)&&angular.copy(o.user,n.$rootScope.user),(null!=o?o.project:void 0)&&angular.copy(o.project,t),e?n.display(r,"关注项目 "+t.user+"/"+t.project+" 成功"):n.display(r,"取消关注 "+t.user+"/"+t.project+" 成功")}))},r.prototype.isStared=function(t){var e,r,o,n,i;if(!t)return!1;if(!(r=null!=(i=this.$rootScope.user)?i.starProjects:void 0))return!1;for(o=0,n=r.length;o<n;o++)if(e=r[o],t.user===e.user&&t.project===e.project)return!0;return!1},r.prototype.pasteLon=function(t,e){var r,o,n,i,u;return i=(r=t.originalEvent.clipboardData.getData("text/plain")).split(","),n=i[0],o=i[1],this.$timeout((u=this,function(){if(null!=n&&(e.longitude=n),null!=o)return e.latitude=o}),50)},r.prototype.pasteLat=function(t,e){var r,o,n,i,u;return i=(r=t.originalEvent.clipboardData.getData("text/plain")).split(","),n=i[0],o=i[1],this.$timeout((u=this,function(){if(null!=n&&null!=o)return e.longitude=n,e.latitude=o}),50)},r.prototype.isAdmin=function(){var t,e;return"admin"===(t=null!=(e=this.$rootScope.user)?e.user:void 0)||t===this.project.user},r.prototype.accessOperation=function(t){var r,o;return!!this.isAdmin()||!(null==(r=null!=(o=this.role)?o.operations:void 0)||!r.length)&&(r[0]===e||__indexOf.call(r,t)>=0)},r}(t.ProjectItemModelController)}});