if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};define(["./controller"],function(t){var e,o;return{AuthController:e=function(t){function e(t,o,r,i,n,a){this.authService=a,e.__super__.constructor.call(this,t,o,r,i,n)}return __extends(e,t),e.prototype.initialize=function(t){var o,r,i,n;return e.__super__.initialize.call(this,t),this.$rootScope.loading=!0,(r=this.$routeParams.token)||(o=this.authService.getTokenCookie(!0))&&(r=o.token),r?(i=this.$routeParams.path||this.$rootScope.lastPath||"/",this.authenticate(r,(n=this,function(t,e){return n.display(t,""),t?n.login():n.$location.url(i).replace(),n.$rootScope.loading=!1}))):(this.login(),this.$rootScope.loading=!1)},e.prototype.authenticate=function(t,e){return this.authService.authenticate(t,(o=this,function(r,i){var n;return r||(null!=i?i.user:void 0)||(r="无效的token: "+t),r||(n={username:i.user,token:t},o.authService.setTokenCookie(n,!0)),"function"==typeof e?e(r,i):void 0}));var o},e.prototype.login=function(){var t;return t=this.getBaseUrl()+"/#/login?path="+this.$rootScope.lastPath,t=this.encodeUrl(t),this.redirect(this.setting.urls.login+"?url="+t)},e}(t.Controller)}});