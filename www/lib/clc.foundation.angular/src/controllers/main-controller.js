if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var o in e)__hasProp.call(e,o)&&(t[o]=e[o]);function r(){this.constructor=t}return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};define(["./controller","qrcode"],function(t,e){var o,r;return{MainController:o=function(t){function o(t,e,r,n,i,a,s,u,c){this.$translate=a,this.storage=s,this.authService=u,this.modelManager=c,o.__super__.constructor.call(this,t,e,r,n,i),this.timestamp=new Date,this.languages=[{key:"cn",name:"中文",title:"切换语言"},{key:"en",name:"English",title:"Switch Language"}],this.loadLanguage()}return __extends(o,t),o.prototype.logout=function(){return this.authService.logout((t=this,function(e){var o,r;return(!(o=t.$rootScope.lastPath)||o.indexOf("/401")>=0||o.indexOf("/error")>=0)&&(o="/"),r=t.getBaseUrl()+"/#/login?path="+o,r=t.encodeUrl(r),t.redirect(t.setting.urls.logout+"?url="+r)}));var t},o.prototype.updateQRCode=function(t,o,r){var n,i;if(null==t&&(t="qrcode"),null==o&&(o=128),null==r&&(r=128),i=this.$location.absUrl(),this.lastQRPath!==i)return this.lastQRPath=i,this.qrcode?(this.qrcode.clear(),this.qrcode.makeCode(i)):(n=document.getElementById(t))?this.qrcode=new e(n,{text:i,width:o,height:r,colorDark:"#000000",colorLight:"#ffffff",correctLevel:e.CorrectLevel.H}):void 0},o.prototype.switchLanguage=function(t){return this.language=t,this.$translate.use(t.key),this.storage.set("language",t.key)},o.prototype.loadLanguage=function(){var t,e,o,r,n;if(e=this.storage.get("language"))for(o=0,r=(n=this.languages).length;o<r;o++)if((t=n[o]).key===e)return void this.switchLanguage(t);return this.switchLanguage(this.languages[0])},o.prototype.authenticate=function(){return this.loadAdminProject(function(t,e){return console.log(null!=t?t:e)})},o.prototype.loadAdminProject=function(t,e){var o,r,n,i,a;if(0!==(i=this.$location.url()).indexOf("/login"))return o={user:"admin",project:"admin"},r=this.$rootScope.adminProject,!e&&r&&r.user===o.user&&r.project===o.project?(this.adminProject=r,"function"==typeof t?t(null,r):void 0):(n=this.modelManager.getService("project")).get(o,(a=this,function(e,o){return a.$rootScope.adminProject=a.adminProject=o,a.storage.set("adminProject",o),"function"==typeof t?t(e,o):void 0}),e)},o}(t.Controller)}});