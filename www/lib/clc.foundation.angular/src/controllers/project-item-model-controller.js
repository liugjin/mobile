if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};define(["./model-with-upload-controller"],function(t){var e,r;return{ProjectItemModelController:e=function(t){function e(t,r,i,o,n,s,u,l,p){e.__super__.constructor.call(this,t,r,i,o,n,s,u,l,p),this.predicate="updatetime",this.pageItems=12,this.reverse=!0,this.idKey=this.options.key[this.options.key.length-1],this.$rootScope.myproject=this.project={user:this.$routeParams.user,project:this.$routeParams.project},this.onLoad(null,this.$rootScope.reload)}return __extends(e,t),e.prototype.onLoad=function(t,e){return this.load(t,e)},e.prototype.load=function(t,e){var r,i,o;return r={user:this.$routeParams.user,project:this.$routeParams.project},i=this.getQueryFields(),this.query(r,i,(o=this,function(e,r){return o.onQuery(e,r),"function"==typeof t?t(e,r):void 0}),e)},e.prototype.getQueryFields=function(){var t;return this.options.key instanceof Array?(t=this.options.key.join(" "),t+=" name group updatetime",this.options.fields&&(t+=" "+this.options.fields)):t=null,t},e.prototype.select=function(t,r){var i,o,n,s,u,l,p;if(!(i=e.__super__.select.call(this,t)))return"function"==typeof r?r("select null item: "+(null!=t?t[this.idKey]:void 0)):void 0;if(t&&!t.createtime&&this.options.key instanceof Array){for(n={},u=0,l=(p=this.options.key).length;u<l;u++)n[o=p[u]]=t[o];this.get(n,r)}else"function"==typeof r&&r(null,i);return s=null!=t?t[this.idKey]:void 0,this.$routeParams[this.idKey]!==s?((n={})[this.idKey]=s,this.addLocationSearch(n)):void 0},e.prototype.onQuery=function(t,e){if(this.items.length)return this.createItemKeys(),this.selectDefaultItem()},e.prototype.getKey=function(t){var e;return t[this.idKey]},e.prototype.createItemKeys=function(){var t,e,r,i,o,n;for(r={},i=0,o=(n=this.items).length;i<o;i++)t=n[i],e=this.getKey(t),t._key=e,r[e]=t;return this.keys=r},e.prototype.selectDefaultItem=function(){var t,e,r,i,o;if(1===this.items.length)return this.select(this.items[0]);if(null!=(e=this.$routeParams[this.idKey]))for(r=0,i=(o=this.items).length;r<i;r++)if((t=o[r])[this.idKey]===e)return void this.select(t);return this.select(this.items[0])},e.prototype.add=function(){return this.current={user:this.project.user,project:this.project.project}},e.prototype.create=function(t,r){var i,o;return null==(i=this.current).user&&(i.user=this.project.user),null==(o=this.current).project&&(o.project=this.project.project),e.__super__.create.call(this,t,r)},e.prototype.filterItem=function(t){return e=this,function(r){return e.filterItemFunc(r,t)};var e},e.prototype.filterItemFunc=function(t,e){var r;return!(r=this.search)||(!!this.filterItemField(r,t,this.idKey,!0,e)||!!this.filterItemField(r,t,"name",!0,e))},e.prototype.filterItemField=function(t,e,r,i,o){var n,s,u;if(!t)return!0;if(n=e,o&&(n=n.model),i){if(t=t.toLowerCase(),(null!=(s=n[r])?s.toString().toLowerCase().indexOf(t):void 0)>=0)return!0}else if((null!=(u=n[r])?u.toString().indexOf(t):void 0)>=0)return!0;return!1},e.prototype.filter=function(t,e,r,i){return null==e&&(e=["name"]),null==r&&(r=!0),o=this,function(n){var s,u,l;if(!t)return!0;for(u=0,l=e.length;u<l;u++)if(s=e[u],o.filterItemField(t,n,s,r,i))return!0;return!1};var o},e.prototype.getNextName=function(t,e){var r;return t?t.replace(/(\d*$)/,function(t,e){var r;return e?parseInt(e)+1:"-0"}):e},e.prototype.copy=function(){var t;return delete(t=angular.copy(this.current))._id,t[this.idKey]=this.getNextName(t[this.idKey]),t.name=this.getNextName(t.name),this.current=t},e}(t.ModelWithUploadController)}});