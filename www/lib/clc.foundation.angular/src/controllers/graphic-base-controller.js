if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){for(var r in t)__hasProp.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};define(["./live-controller"],function(e){var t,r;return{GraphicBaseController:t=function(e){function t(e,r,o,l,i,n,a,p,s,h,u,c,d){t.__super__.constructor.call(this,e,r,o,l,i,n,a,p,s,h,u,c,d),this.initializeGraphicOptions(),this.initializeEvents(),this.initializeView()}return __extends(t,e),t.prototype.initializeGraphicOptions=function(){var e,t;return this.graphicOptions={engineOptions:{parameters:this.$routeParams},renderOptions:{editable:!1,type:null!=(e=null!=(t=this.$routeParams.renderer)?t:this.$rootScope.renderType)?e:"snapsvg",uploadUrl:this.options.uploadUrl}}},t.prototype.initializeView=function(){return this.placeholder=$("#element-placeholder"),this.placeholder.draggable(),this.placeholderSize={width:this.placeholder.width(),height:this.placeholder.height(),width2:this.placeholder.width()/2,height2:this.placeholder.height()/2},this.popover=$("#element-placeholder-popover"),this.viewerPosition=$("#player").offset()},t.prototype.movePlaceholderByEvent=function(e){var t,r;"dynamic"!==(t=this.template.getPropertyValue("placeholder-mode"))&&"element"!==t||(r={left:e.pageX,top:e.pageY},this.placeholder.offset(r))},t.prototype.showPopover=function(e){var t;null==this.placeholder&&(this.placeholder=$("#element-placeholder")),t={left:e.pageX,top:e.pageY},this.placeholder.offset(t),this.placeholder.webuiPopover("show"),this.popoverState=!0},t.prototype.togglePopover=function(e){null==this.placeholder&&(this.placeholder=$("#element-placeholder")),this.popoverState=!this.popoverState,this.popoverState?this.placeholder.webuiPopover("show"):this.placeholder.webuiPopover("hide")},t.prototype.onElementChanged=function(){return function(e,t){if(e)return console.log(e)}},t.prototype.onTemplateLoad=function(){return e=this,function(t,r){if(t&&console.log(t),r)return e.element=e.template=r,console.log((new Date).toISOString()+" load template "+r.id),e.templateParameters=null,e.initializePlaceholder(),r.subscribe(function(t){var o,l;return o=t.element,"element"===(l=r.getPropertyValue("placeholder-mode"))&&(null!=o?o.getPropertyValue("tooltip"):void 0)&&e.movePlaceholderToElement(o),e.element=null!=o?o:r,e.applyChange()},"select",100)};var e},t.prototype.initializePlaceholder=function(){var e,t,r;return e=this.template,r=this,t=function(){var t,o,l,i,n,a,p;return l=e.getPropertyValue("placeholder-image"),a=e.getPropertyValue("placeholder-x",50),p=e.getPropertyValue("placeholder-y",50),n=e.getPropertyValue("placeholder-width",20),o=e.getPropertyValue("placeholder-height",20),r.placeholderMode=i=e.getPropertyValue("placeholder-mode","dynamic"),r.timelineEnable=e.getPropertyValue("timeline-enable",!1),(t={left:a,top:p,width:n,height:o})["background-image"]=l?"url("+r.setting.urls.uploadUrl+"/"+l+")":"url(/visualization/res/img/popover.gif)",r.placeholder.css(t),"none"===i?r.placeholder.hide():"dynamic"===i||"element"===i?(r.placeholder.draggable("enable"),r.placeholder.show()):(r.placeholder.draggable("disable"),r.placeholder.show()),r.placeholderSize={x:a,y:p,width:n,height:o,width2:n/2,height2:o/2}},e.subscribePropertiesValue(["placeholder-image","placeholder-x","placeholder-y","placeholder-width","placeholder-height","placeholder-mode"],function(e){return t()},100),t()},t.prototype.exportImage=function(){return this.player.exportImage()},t.prototype.stretch=function(){var e,t;return null!=(e=this.player.renderer)&&null!=(t=e.transformControl)?t.stretch():void 0},t.prototype.zoom=function(e){var t,r;return null!=(t=this.player.renderer)&&null!=(r=t.transformControl)?r.zoom(e):void 0},t.prototype.reset=function(){var e,t;return null!=(e=this.player.renderer)&&null!=(t=e.transformControl)?t.reset():void 0},t.prototype.pan=function(e,t){var r,o;return null!=(r=this.player.renderer)&&null!=(o=r.transformControl)?o.pan(e,t):void 0},t.prototype.getPropertyValue=function(e,t,r){var o,l;return this.template?(o=this.template.getElement(e,!0))?l=o.getPropertyValue(t,r):r:null},t.prototype.setPropertyValue=function(e,t,r){var o;if(this.template&&(o=this.template.getElement(e,!0)))return o.setPropertyValue(t,r)},t.prototype.initializeEvents=function(){var e,t,r;return r=this,t=function(e){if(document.activeElement===document.body&&e.shiftKey)switch(e.keyCode){case 87:r.fullscreen(".graphic-viewer");break;case 80:r.exportImage();break;case 69:r.goto("/graphic-templates/"+r.current.user+"/"+r.current.project+"/"+r.current.template+"/edit");break;case 73:r.openParameters(),$("#parameters-modal").modal("open"),r.applyChange()}},(e=document.body).addEventListener("keydown",t),this.addHandler(function(r){return function(){return e.removeEventListener("keydown",t)}}(this))},t.prototype.openParameters=function(){var e,t,r,o;if(this.template){for(r=0,o=(t=this.template.getParameters()).length;r<o;r++)(e=t[r]).value2=e.getValue();return this.templateParameters=t}},t.prototype.setParameters=function(){var e,t,r,o,l;if(this.templateParameters){for(t={},r=0,o=(l=this.templateParameters).length;r<o;r++)t[(e=l[r]).id]=e.value2;return this.parameters=t}},t.prototype.getSignal=function(e){var t,r;if(e&&this.player)return"string"!=typeof e&&(e=e.station+"/"+e.equipment+"/"+e.signal),r="signal-values/"+this.$routeParams.user+"/"+this.$routeParams.project+"/"+e,null!=(t=this.player.signalLiveSession.getItem(r))?t.message:void 0},t.prototype.subscribeSignalValues=function(e,t){var r;if(e&&this.player)return"string"==typeof e?(r="signal-values/"+this.$routeParams.user+"/"+this.$routeParams.project+"/"+e,this.player.signalLiveSession.subscribe(r,t)):(e.user=this.$routeParams.user,e.project=this.$routeParams.project,this.player.signalLiveSession.subscribeValues(e,t))},t.prototype.getSignalColor=function(e,t){var r,o,l,i,n,a,p,s,h,u,c,d;if(t&&("string"==typeof e&&(e=this.getSignal(e)),e)){if(null==this.colors&&(this.colors={}),!(o=this.colors[t])){this.colors[t]=o=[];try{for(i=t.split(","),s=0,u=i.length;s<u;s++)p=(l=i[s]).split(":"),o.push({value:parseFloat(p[0]),color:p[1].trim()})}catch(e){n=e,console.log(n)}}for(a=e.value,h=0,c=o.length;h<c;h++)if(a<=(r=o[h]).value)return r.color;return null!=a?null!=r?r.color:void 0:null!=(d=o[0])?d.color:void 0}},t.prototype.subscribeOnTooltip=function(e,t,r){var o;if(this.tooltipKey!==e)return this.tooltipKey=e,null!=(o=this.tooltipHandle)&&o.dispose(),this.tooltipHandle=this.subscribeSignalValues(t,r)},t.prototype.inspect=function(e){return this.player.inspect((t=this,function(e,r){return t.showPopoverToElement(e,r)}),e);var t},t.prototype.pauseInspecting=function(){return this.player.pauseInspecting()},t.prototype.stopInspecting=function(){return this.player.stopInspecting()},t.prototype.showPopoverToElement=function(e,t){var r,o;return"end"===e?(r=this.viewerPosition.left+this.placeholderSize.width,o=this.viewerPosition.top+this.placeholderSize.height,this.placeholder.offset,this.popover.webuiPopover("hide")):this.movePlaceholderToElement(t)},t.prototype.movePlaceholderToElement=function(e){var t,r,o;e&&(r=(t=e._geometry.node.getBoundingClientRect()).left+t.width/2-this.placeholderSize.width/2,o=t.top+t.height/2-this.placeholderSize.height/2,this.placeholder.offset({left:r,top:o}))},t}(e.LiveController)}});