if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var i in e)__hasProp.call(e,i)&&(t[i]=e[i]);function s(){this.constructor=t}return s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype,t};define(["../disposable"],function(t){var e,i;return{PagingModel:e=function(t){function e(t,i){var s,r,n,o;this.options=null!=t?t:{},this.pageCallback=i,e.__super__.constructor.apply(this,arguments),this.predicate=null!=(s=this.options.predicate)?s:"",this.reverse=null!=(r=this.options.reverse)&&r,this.pageItems=null!=(n=this.options.pageItems)?n:12,this.key=null!=(o=this.options.key)?o:"_id",this.page=1,this.pages=[],this.pageCount=0,this.itemCount=0,this.items=[],this.keys={}}return __extends(e,t),e.prototype.setItems=function(t,e){var i,s,r,n,o,p;if(n={},t)if(t instanceof Array)for(o=0,p=t.length;o<p;o++)r=(i=t[o])[this.key],n[r]=i;else for(s in t)r=(i=t[s])[this.key],n[r]=i;else;return this.items=function(){var t;for(s in t=[],n)i=n[s],t.push(i);return t}(),this.keys=n,e?this.setPaging(e):this.processPages(),this.items},e.prototype.addItem=function(t,e){var i,s,r,n;if(t){if(s=t[this.key],r=this.keys[s]){for(i in t)n=t[i],r[i]=n;return r}return this.keys[s]=t,this.items.push(t),e||this.processPages(),t}},e.prototype.removeItem=function(t){var e,i;if(t){if("string"==typeof t){if(i=t,!(t=this.keys[i]))return-1}else i=t[this.key];return delete this.keys[i],e=this.items.indexOf(t),this.items.splice(e,1),this.processPages(),e}},e.prototype.removeById=function(t){var e;return e=this.keys[t],this.removeItem(e)},e.prototype.sortBy=function(t){return this.predicate===t?this.reverse=!this.reverse:(this.predicate=t,this.reverse=!0)},e.prototype.nextPage=function(){if(this.page<this.pageCount)return this.setPage(this.page+1)},e.prototype.previousPage=function(){if(this.page>1)return this.setPage(this.page-1)},e.prototype.setPage=function(t){if(this.page!==t)return(!t||t>this.pageCount)&&(t=1),this.page=t,this.onPageChange(t)},e.prototype.onPageChange=function(t){return"function"==typeof this.pageCallback?this.pageCallback(t):void 0},e.prototype.processPages=function(t){var e,i,s,r;if(e=this.items.length,t||this.itemCount!==e)return this.itemCount=e,this.pageCount=Math.ceil(e/this.pageItems),0===this.pageCount?this.pages=[]:this.pages=function(){r=[];for(var t=1,e=this.pageCount;1<=e?t<=e:t>=e;1<=e?t++:t--)r.push(t);return r}.apply(this),this.page>this.pageCount?this.setPage(this.pageCount-1):void 0},e.prototype.setPaging=function(t){var e,i,s;return this.pageItems=t.pageItems,this.itemCount=t.count,this.pageCount=t.pageCount,0===this.pageCount?this.pages=[]:this.pages=function(){s=[];for(var t=1,e=this.pageCount;1<=e?t<=e:t>=e;1<=e?t++:t--)s.push(t);return s}.apply(this),this.setPage(t.page)},e.prototype.filter=function(t,e,i){return null==e&&(e=["name"]),null==i&&(i=!0),s=this,function(r){var n,o,p;if(!t)return!0;for(o=0,p=e.length;o<p;o++)if(n=e[o],s.filterItemField(t,r,n,i))return!0;return!1};var s},e.prototype.filterItemField=function(t,e,i,s){var r,n,o;if(!(r=null!=(n=e[i])?n:null!=(o=e.model)?o[i]:void 0))return!1;if(s){if(t=t.toLowerCase(),r.toLowerCase().indexOf(t)>=0)return!0}else if(r.indexOf(t)>=0)return!0;return!1},e}(t.Disposable)}});