if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);function s(){this.constructor=e}return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e};define(["./items-base","./view-model"],function(e,t){var i,s;return{ItemsModel:i=function(e){function i(e,t){this.parent=e,i.__super__.constructor.call(this,t),this.engine=this.parent.engine,this.caches={}}return __extends(i,e),i.prototype.load=function(e,t,i,s){var n,r,o;if(r=JSON.stringify(e)+"&"+t,s&&(this.reset(),delete this.caches[r]),!(n=this.caches[r]))return n={filter:e,fields:t,callbacks:[i]},this.caches[r]=n,null==this.service&&(this.service=this.engine.modelManager.getService(this.options.id)),this.service.query(e,t,(o=this,function(e,t){var i,s,r,c,a;for(s=e?[]:o.addItems(t),o.loaded=!0,n.loaded=!0,n.items=s,r=0,c=(a=n.callbacks).length;r<c;r++)"function"==typeof(i=a[r])&&i(e,s);return n.callbacks=[]}),s);n.loaded?"function"==typeof i&&i(null,n.items):n.callbacks.push(i)},i.prototype.createItem=function(e){var i;return new t.ViewModel(this,e)},i.prototype.dispose=function(e){i.__super__.dispose.call(this,e),e||(this.cache={})},i}(e.ItemsBase)}});