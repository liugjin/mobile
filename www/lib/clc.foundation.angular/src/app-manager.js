if("function"!=typeof define)var define=require("amdefine")(module);define([],function(){var t,n;return{AppManager:t=function(){function t(t){this.app=t}return t.prototype.config=function(t,n){return this.app.config(["$routeProvider","$locationProvider","$translateProvider","$sceDelegateProvider",function(e,r,o,i){var u;return r.html5Mode({enabled:!1,requireBase:!1}).hashPrefix(""),i.resourceUrlWhitelist(["**"]),o.useSanitizeValueStrategy("escaped"),o.useStaticFilesLoader({prefix:"/"+t+"/res/languages/locale-",suffix:".json"}),(u=new n.Router(e)).start()}])},t.prototype.connect=function(t){return this.app.factory("socket",["$location","socketFactory",function(n,e){var r,o,i,u;return r=n.$$protocol+"://"+n.$$host+":"+(null!=(u=window.setting.ioPort)?u:n.port()),console.log((new Date).toISOString()+" connecting socket.io to "+r),(o=e({ioSocket:i=t(r,{reconnection:!0,sendSidInHeaders:!0,transports:["websocket","polling"]})})).forward("error"),o}])},t.prototype.run=function(t,n,e){return this.login(t),n&&this.lang(n),e&&this.trust(),this.app},t.prototype.login=function(t){return null==t&&(t=[]),this.app.run(["$rootScope","$location",function(n,e){n.$on("$routeChangeStart",function(r,o,i){var u,a,c,s;if(n.path=a=e.url(),!n.user){for(c=0,s=(t=["/register","/login"].concat(t)).length;c<s;c++)if(u=t[c],a.indexOf(u)>=0)return;return n.lastPath=a,e.path("/login")}})}])},t.prototype.lang=function(t){return null==t&&(t="zh-cn"),this.app.run(["amMoment",function(n){return n.changeLocale(t)}])},t.prototype.trust=function(){return this.app.run(["$rootScope","$sce",function(t,n){return t.trustSrc=function(t){return null!=n?n.trustAsResourceUrl(t):void 0}}])},t}()}});