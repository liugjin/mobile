if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){for(var r in t)__hasProp.call(t,r)&&(e[r]=t[r]);function o(){this.constructor=e}return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};define(["./service"],function(e){var t,r;return{ResourceModelService:t=function(e){function t(e,r){this.$resource=e,t.__super__.constructor.apply(this,arguments),this.bind(r)}return __extends(t,e),t.prototype.bind=function(e){var t,r,o,n;if(e)return this.options=e,this.keys={},this.model={loaded:!1,current:null,err:null,items:[]},r=null!=(o=e.params)?o:{id:"@_id"},(t=null!=(n=e.actions)?n:{}).update={method:"PUT"},t.remove={method:"DELETE"},t.query={method:"GET",isArray:!0,transformResponse:function(e){var t;return t=angular.fromJson(e),angular.isArray(t)?t:[t]}},this.Resource=this.$resource(e.url,r,t)},t.prototype.select=function(e){if(this.model.current!==e)return this.model.current=angular.copy(e)},t.prototype.selectByKey=function(e){var t;return t=this.keys[e],this.select(t),t},t.prototype.load=function(e,t){var r,o;return!t&&this.model.loaded?"function"==typeof e&&e(null,this.model.items):this.model.items=r=this.Resource.query((o=this,function(t){var n,i,u,s,c,f,d;if(o.model.err=i=t._err,!i){for(o.keys={},s=null!=(d=o.options.key)?d:"_id",c=0,f=r.length;c<f;c++)u=r[c],o.keys[u[s]]=u;o.options.current&&(n=o.selectByKey(o.options.current)),o.model.loaded=!0}return"function"==typeof e?e(i,t):void 0}),function(t){return function(r){var o;return o=r.data,t.model.err=o,"function"==typeof e?e(o):void 0}}(this)),this.model},t.prototype.get=function(e,t){var r,o;return this.keys.hasOwnProperty(e)?(r=this.keys[e],"function"==typeof t&&t(null,r),r):r=this.Resource.$get(filter,(o=this,function(e){var n,i,u;return o.model.err=n=e._err,n||(i=null!=(u=o.options.key)?u:"_id",o.keys[r[i]]=r,o.model.items.push(r),o.select(r)),"function"==typeof t?t(n,e):void 0}),function(e){return function(r){var o;return o=r.data,e.model.err=o,"function"==typeof t?t(o):void 0}}(this))},t.prototype.create=function(e,t){var r,o;return(r=new this.Resource(e)).$save((o=this,function(e){var n,i,u;return o.model.err=n=e._err,n||(i=null!=(u=o.options.key)?u:"_id",o.keys[r[i]]=r,o.model.items.push(r),o.select(r)),"function"==typeof t?t(n,e):void 0}),function(e){return function(r){var o;return o=r.data,e.model.err=o,"function"==typeof t?t(o):void 0}}(this))},t.prototype.update=function(e,t){return e.$update((r=this,function(o){var n,i,u,s;return r.model.err=n=o._err,n||(u=null!=(s=r.options.key)?s:"_id",i=r.keys[e[u]],angular.copy(e,i)),"function"==typeof t?t(n,o):void 0}),function(e){return function(r){var o;return o=r.data,e.model.err=o,"function"==typeof t?t(o):void 0}}(this));var r},t.prototype.remove=function(e,t){return e.$remove((r=this,function(o){var n,i,u,s,c,f,d;if(r.model.err=n=o._err,i=e._id,!n)for(delete r.keys[i],u=f=0,d=(c=r.model.items).length;f<d;u=++f)if((e=c[u])._id===i){s=u===c.length-1?c[0]:c[u+1],c.splice(u,1),r.select(s);break}return"function"==typeof t?t(n,o):void 0}),function(e){return function(r){var o;return o=r.data,e.model.err=o,"function"==typeof t?t(o):void 0}}(this));var r},t}(e.Service)}});