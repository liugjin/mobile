if("function"!=typeof define)var define=require("amdefine")(module);define([],function(){var e,t;return{MarkdownModalDirective:e=function(e){return{restrict:"AE",require:"ngModel",replace:!0,scope:{name:"@",ngModel:"="},template:'<div md-modal="md-modal" class="modal modal-fixed-footer"><div class="modal-content"><label>{{name}} (markdown)</label><div ng-show="view == \'edit\'" ui-ace="{mode: \'markdown\', onLoad: aceLoaded, onChange: onChange}" ng-model="content" class="text-editor"></div><p ng-show="view == \'html\'" markdown="ngModel"></p><image-uploader id="imageUploader" ng-model="Img" dir="{{uploadUrl}}" on-upload="onImageUpload()" class="imageUploader hide"></image-uploader><file-uploader id="fileUploader" ng-model="File" dir="{{uploadUrl}}" on-upload="onFileUpload()" class="fileUploader hide"></file-uploader></div><div class="modal-footer"><a ng-click="save(true)" class="btn-flat left">保存<i class="material-icons left">save</i></a><a ng-click="view = &quot;html&quot;; save()" ng-class="{&quot;teal-text&quot;: view == &quot;html&quot;}" class="btn-flat left">浏览<i class="material-icons left">book</i></a><a ng-click="view = &quot;edit&quot;" ng-class="{&quot;teal-text&quot;: view == &quot;edit&quot;}" class="btn-flat left">编辑<i class="material-icons left">edit</i></a><a ng-click="insertImage()" ng-show="view == &quot;edit&quot;" class="btn-flat left"><i class="material-icons left">insert_photo</i>插入图片</a><a ng-click="pasteImage()" ng-show="view == &quot;edit&quot;" class="btn-flat left"><i class="material-icons left">add_to_photos</i>粘贴图片</a><a ng-click="insertFile()" ng-show="view == &quot;edit&quot;" class="btn-flat left"><i class="material-icons left">attach_file</i>插入附件</a><a href="" class="waves-effect waves-teal btn-flat modal-action modal-close">关闭<i class="material-icons left">close</i></a></div></div>',link:{pre:function(e,t,a){return e.aceLoaded=function(t){return e.editor=t}},post:function(e,t,a){var o,i,l;return e.uploadUrl=window.setting.urls.uploadUrl,e.view="edit",e.$watch("ngModel",function(t){return e.content=e.ngModel}),o=function(t){var a,o,i;if(a=e.editor,t&&a)return i=a.getSession(),o=a.getCursorPosition(),i.insert(o,t)},e.save=function(a){e.ngModel=e.content,a&&"function"==typeof t.modal&&t.modal("close")},e.insertImage=function(){return $('#imageUploader input[type="file"]',t).click()},e.onImageUpload=function(){return function(e,t){if(!e&&t)return l(t)}},l=function(t){var a;if(t)return a="!["+t+"]("+e.uploadUrl+"/"+t+")\n",o(a)},e.insertFile=function(){return $('#fileUploader input[type="file"]',t).click()},e.onFileUpload=function(){return function(e,t){if(!e&&t)return i(t)}},i=function(t){var a;if(t)return a="["+t+"]("+e.uploadUrl+"/"+t+")\n",o(a)},e.pasteImage=function(){return e.$broadcast("pasteImage")}}}}}}});