if("function"!=typeof define)var define=require("amdefine")(module);define([],function(){var e,n;return{ImageUploaderDirective:e=function(e,n){return{restrict:"AE",require:"ngModel",replace:!0,scope:{dir:"@",filename:"@",accept:"@",ngModel:"=",upload:"&",onUpload:"&",paste:"&"},template:"<div style='width: 100%; height: 100%;' title='{{ngModel && ngModel || \"拖动或选择打开图片文件\"}}' ng-mouseenter='toolbar=true' ng-mouseleave='toolbar=false'>\n  <div ng-show='!showLink' style='cursor: pointer; width: 100%; height: 100%; position: relative; display: table; text-align: center;' class='img-preview'>\n    <img ng-if='ngModel', ng-src='{{ngModel ? dir + \"/\" + ngModel : null}}' style='position: absolute; left: 0; right: 0; top: 0; bottom: 0; margin: auto' />\n    <a ng-if='!ngModel' style='display: table-cell; vertical-align: middle'><i class='material-icons small'>file_upload</i></a>\n  </div>\n  <textarea ng-show='showLink' style='width: 100%; height: 100%; resize: none;' ng-model='ngModel'></textarea>\n  <input type='file' name='uploadInput' accept='{{accept}}' style='display: none' />\n  <div class='progress' ng-show='progress > 0 && progress < 100' title='上载进度：{{name}} {{progress | number:1}}%'>\n    <div class='determinate' style='width: {{progress}}%'></div>\n  </div>\n  <div style='position: relative; float: right; margin: 5px; top: -40px;' ng-show='toolbar'>\n    <span class='img-copy' title='复制粘贴板图片' ng-click='pasteImage()'>\n        <a href='' style='color: grey;' onMouseOver='this.style.color=\"orange\"' onMouseOut='this.style.color=\"grey\"'>\n          <i class='material-icons small'>add_to_photos</i>\n        </a>\n    </span>\n    <span ng-show='ngModel' class='img-remove' title='删除图片' ng-click='ngModel = \"\"'>\n        <a href='' style='color: grey;' onMouseOver='this.style.color=\"orange\"' onMouseOut='this.style.color=\"grey\"'>\n          <i class='material-icons small'>delete</i>\n        </a>\n    </span>\n    <span class='img-link' title='显示或设置图片链接' ng-click='showLink = !showLink'>\n        <a href='' style='color: grey;' onMouseOver='this.style.color=\"orange\"' onMouseOut='this.style.color=\"grey\"'>\n          <i class='material-icons small'>link</i>\n        </a>\n    </span>\n    <span ng-show='ngModel' class='img-link' title='下载图片'>\n        <a ng-href='{{dir}}/{{ngModel}}' target='_blank' style='color: grey;' onMouseOver='this.style.color=\"orange\"' onMouseOut='this.style.color=\"grey\"'>\n          <i class='material-icons small'>file_download</i>\n        </a>\n    </span>\n  </div>\n</div>",link:function(e,t,i){var o,l,a;return null==e.accept&&(e.accept="image/*"),l=t.find(".img-preview"),o=t.find('input[type="file"]'),l.bind("click",function(){return o.click()}),o.bind("change",function(t){var i,l;return n?a(null!=(i=o[0])&&null!=(l=i.files)?l[0]:void 0):"function"==typeof e.upload&&e.upload()(o[0]),t.target.value=null}),a=function(i){var o,l,a;if(i)return(l=new FileReader).onload=function(e){var n;return(n=t.find("img")).attr("src",e.target.result)},l.readAsDataURL(i),e.name=i.name,a=e.dir+"/"+i.name,o=e.filename,n.upload(i,o,a,function(n,t){var i;return n?console.log(n):e.ngModel=""+t.resource+t.extension+"?"+(new Date).getTime(),"function"==typeof e.onUpload&&"function"==typeof(i=e.onUpload())?i(n,e.ngModel):void 0},function(n){return e.progress=100*n})},t.on("drop",function(e){var n,t,i,o;return e.preventDefault(),e.stopPropagation(),n=null!=(i=(t=e.originalEvent).dataTransfer)&&null!=(o=i.files)?o[0]:void 0,a(n)}),t.on("paste",function(e){var n,t,i,o,l;if(!$(e.target).is(":input"))for(e.preventDefault(),e.stopPropagation(),i=0,o=(l=e.originalEvent.clipboardData.items).length;i<o;i++)if("file"===(t=l[i]).kind&&t.type.indexOf("image")>=0)return n=t.getAsFile(),void a(n)}),e.pasteImage=function(){return navigator.permissions.query({name:"clipboard-read"}).then(function(n){return navigator.clipboard.read().then((t=this,function(n){var t,i,o,l,r,s,g;for(o=0,r=n.length;o<r;o++)for(l=0,s=(g=(t=n[o]).types).length;l<s;l++)"text/plain"!==(i=g[l])&&t.getType(i).then(function(n){var t;return(t=e.filename)&&t.indexOf(".")<0&&(t+=".png"),null==n.name&&(n.name=null!=t?t:(new Date).getTime()+".png"),a(n)})}));var t})},e.$on("pasteImage",function(n,t){return e.pasteImage()})}}}}});