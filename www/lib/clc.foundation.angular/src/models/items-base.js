if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};define(["./paging-model","rx"],function(t,e){var r,i;return{ItemsBase:r=function(t){function r(t){r.__super__.constructor.call(this,t),this.items=[],this.keys={},this.index=0,this.subject=new e.Subject}return __extends(r,t),r.prototype.getKey=function(t,e){var r,i,s,n,o,p,u,h,d;if(p=null!=(n=this.options.keys)?n.length:void 0){for(u=this.options.keysSeperator||"_",s="",o=p-1,r=d=0;0<=o?d<o:d>o;r=0<=o?++d:--d)s+=t[i=n[r]]+u;s+=h=e?t.parent:t[i=n[o]]}else s=t._id;return s},r.prototype.getItem=function(t){return this.keys[t]},r.prototype.getItemByIds=function(t,e){var r;return r=this.getKey(t,e),this.getItem(r)},r.prototype.getModels=function(){var t,e;return function(){var e,r,i,s;for(s=[],e=0,r=(i=this.items).length;e<r;e++)t=i[e],s.push(t.model);return s}.call(this)},r.prototype.addItems=function(t){var e,r,i,s,n;if(!t)return[];if(i=[],t instanceof Array)for(s=0,n=t.length;s<n;s++)r=t[s],e=this.addItem(r),i.push(e);else e=this.addItem(t),i.push(e);return i},r.prototype.addItem=function(t){var e,r;return r=this.getKey(t),(e=this.keys[r])?(e.setModel(t,r),e):(e=this.createItem(t))?(e.setModel(t,r),this.appendItem(e)):void 0},r.prototype.createItem=function(t){return t},r.prototype.addNewItem=function(t){return this.appendItem(t)},r.prototype.appendItem=function(t){var e,r,i;return t.index=++this.index,e=!1,(i=this.keys[t.key])&&(r=this.items.indexOf(i))>=0&&(this.items[r]=t,e=!0),e||this.items.push(t),this.keys[t.key]=t,this.subject.onNext({type:"add",item:t}),t},r.prototype.removeItem=function(t,e){var r,i;if(null==e&&(e=!0),i=this.keys[t])return delete this.keys[t],(r=this.items.indexOf(i))>=0&&this.items.splice(r,1),this.subject.onNext({type:"remove",item:i}),e&&i.dispose(),i},r.prototype.reset=function(){var t,e,r,i,s;for(r=function(){var e,r,i,s;for(s=[],e=0,r=(i=this.items).length;e<r;e++)t=i[e],s.push(t.key);return s}.call(this),i=0,s=r.length;i<s;i++)e=r[i],this.removeItem(e,!1);return this.index=0},r.prototype.dispose=function(t){r.__super__.dispose.apply(this,arguments),t||(this.reset(),this.subject.dispose())},r.prototype.subscribe=function(t,e,r){var i,s;return s=this.subject,t&&(s=s.where(function(e){return e.type===t})),r&&(s=s.throttle(r)),i=s.subscribe(e),this.addHandler(i)},r}(t.PagingModel)}});