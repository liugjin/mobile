if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){for(var i in t)__hasProp.call(t,i)&&(e[i]=t[i]);function n(){this.constructor=e}return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define(["./paging-model","./view-model"],function(e,t){var i,n;return{ItemsModel:i=function(e){function i(e,t){this.parent=e,i.__super__.constructor.call(this,t),this.engine=this.parent.engine,this.items=[],this.keys={},this.index=0,this.caches={}}return __extends(i,e),i.prototype.load=function(e,t,i,n){var s,r,o;if(r=JSON.stringify(e)+"&"+t,n&&delete this.caches[r],!(s=this.caches[r]))return s={filter:e,fields:t,callbacks:[i]},this.caches[r]=s,null==this.service&&(this.service=this.engine.modelManager.getService(this.options.id)),this.service.query(e,t,(o=this,function(e,t){var i,n,r,p,h;for(n=o.addItems(t),o.loaded=!0,r=0,p=(h=s.callbacks).length;r<p;r++)"function"==typeof(i=h[r])&&i(e,n);return s.loaded=!0,s.items=n,s.callbacks=[]}),n);s.loaded?"function"==typeof i&&i(null,s.items):s.callbacks.push(i)},i.prototype.getKey=function(e){var t,i,n,s,r,o,p,h;if(null!=(p=this.options.keys)?p.length:void 0)for(s=this.options.keysSeperator||"_",n="",t=r=0,o=(h=this.options.keys).length;r<o;t=++r)t>0&&(n+=s),n+=e[i=h[t]];else n=e._id;return n},i.prototype.getItem=function(e){return this.keys[e]},i.prototype.getItemByIds=function(e){var t;return t=this.getKey(e),this.getItem(t)},i.prototype.getModels=function(){var e,t;return function(){var t,i,n,s;for(s=[],t=0,i=(n=this.items).length;t<i;t++)e=n[t],s.push(e.model);return s}.call(this)},i.prototype.addItems=function(e){var t,i,n,s,r;if(!e)return[];if(n=[],e instanceof Array)for(s=0,r=e.length;s<r;s++)i=e[s],t=this.addItem(i),n.push(t);else t=this.addItem(e),n.push(t);return n},i.prototype.addItem=function(e){var t,i;if(t=this.createItem(e))return i=this.getKey(e),t.setModel(i,e),this.appendItem(t)},i.prototype.createItem=function(e){var i;return new t.ViewModel(this,e)},i.prototype.addNewItem=function(e){return this.appendItem(e)},i.prototype.appendItem=function(e){return e.index=++this.index,this.items.push(e),this.keys[e.key]=e,e},i.prototype.removeItem=function(e){var t;if(t=this.keys[e])return delete this.keys[e],this.items.splice(this.items.indexOf(t),1),t.dispose(),t},i.prototype.reset=function(){var e,t,i,n;for(t=0,i=(n=this.items).length;t<i;t++)e=n[t],this.removeItem(e.key)},i.prototype.dispose=function(){return i.__super__.dispose.apply(this,arguments),this.reset()},i}(e.PagingModel)}});