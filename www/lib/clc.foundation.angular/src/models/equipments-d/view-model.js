if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define(["../../disposable"],function(e){var t,o;return{ViewModel:t=function(e){function t(e,o){this.parent=e,this.model=null!=o?o:{},t.__super__.constructor.apply(this,arguments),this.engine=this.parent.engine}return __extends(t,e),t.prototype.getIds=function(){return{}},t.prototype.setModel=function(e,t){var o,r,n;if(this.key=null!=e?e:null!=(n=this.parent)?n.getKey(t):void 0,!t||t===this.model)return t;for(o in this.reset(),t)r=t[o],this.model[o]=r;return this.model},t.prototype.getModelService=function(){return null==this.service&&(this.service=this.engine.modelManager.getService(this.parent.options.id)),this.service},t.prototype.load=function(e,t,o,r){var n,i;if(r||!this.loaded)return(n=this.getModelService()).get(e,t,(i=this,function(e,t){var r;return i.loaded=!0,r=i.setModel(null,t),"function"==typeof o?o(e,r):void 0}),r);"function"==typeof o&&o(null,this.model)},t.prototype.reset=function(){var e,t,o;for(e in o=this.model)t=o[e],delete this.model[e]},t.prototype.dispose=function(){return t.__super__.dispose.apply(this,arguments),this.reset()},t.prototype.display=function(e,t,o){var r,n;if(r=o||5e3,n=this.formatErrorInfo(e,t))return M.toast({html:n,displayLength:r})},t.prototype.formatErrorInfo=function(e,t){var o;return e?(o="object"==typeof e?JSON.stringify(e):e,console.log(o)):o=t,o},t.prototype.getChanges=function(e){var t,o,r;for(o in null==e&&(e=this.model),t={_id:e._id},e)r=e[o],"_"!==o[0]&&(t[o]=r);return t},t.prototype.update=function(e){var t,o,r;return t=this.getChanges(),(o=this.getModelService()).update(t,(r=this,function(t,o){return r.setModel(null,o),r.display(t,"数据更新成功！"),"function"==typeof e?e(t,o):void 0}))},t.prototype.remove=function(e){var t,o,r;return t=this.getChanges(),(o=this.getModelService()).remove(t,(r=this,function(t,o){var n;return!t&&o&&null!=(n=r.parent)&&n.removeItem(r.key),r.display(t,"数据删除成功！"),"function"==typeof e?e(t,o):void 0}))},t.prototype.create=function(e){var t,o,r;return t=this.getChanges(),(o=this.getModelService()).create(t,(r=this,function(t,o){var n;return!t&&o&&(r.setModel(null,o),null!=(n=r.parent)&&n.addNewItem(r)),r.display(t,"数据创建成功！"),"function"==typeof e?e(t,o):void 0}))},t.prototype.save=function(e){return this.model._removed?this.remove(e):this.model._id?this.update(e):this.create(e)},t}(e.Disposable)}});