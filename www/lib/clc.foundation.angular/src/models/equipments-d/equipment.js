if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(t,e){for(var n in e)__hasProp.call(e,n)&&(t[n]=e[n]);function o(){this.constructor=t}return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};define(["./view-model","./properties","./signals","./events","./commands","underscore"],function(t,e,n,o,i,s){var r,p;return{Equipment:r=function(t){function r(t,s){r.__super__.constructor.call(this,t,s),this.station=this.parent.parent,this.project=this.station.project,this.properties=new e.Properties(this),this.signals=new n.Signals(this),this.events=new o.Events(this),this.commands=new i.Commands(this),this.sampleUnits={}}return __extends(r,t),r.prototype.getIds=function(){var t;return(t=this.station.getIds()).equipment=this.model.equipment,t},r.prototype.loadEquipmentTemplate=function(t,e,n){var o,i;return!n&&this.templateLoaded?"function"==typeof e?e(null,this.equipmentTemplate):void 0:(o={type:this.model.type,template:this.model.template},this.project.loadEquipmentTemplate(o,t,(i=this,function(t,n){return i.templateLoaded=!0,i.setEquipmentTemplate(n),"function"==typeof e?e(t,i.equipmentTemplate):void 0}),n))},r.prototype.setModel=function(t,e){var n,o,i,s,p,a;if(i=r.__super__.setModel.call(this,t,e),this.image=this.model.image,o={},this.model.properties)for(s=0,p=(a=this.model.properties).length;s<p;s++)o[(n=a[s]).id]=n.value;return this.propertyValues=o,i},r.prototype.setEquipmentTemplate=function(t){var e,n,o,i,s;if(t&&(this.model.image||(this.image=t.getModelValue("image")),this.sampleUnits=t.getSampleUnits(),this.model.sampleUnits))for(o=0,i=(s=this.model.sampleUnits).length;o<i;o++)n=s[o],(e=this.sampleUnits[n.id])&&null!=n.value&&(e.value=n.value);return this.equipmentTemplate=t},r.prototype.getChanges=function(t){var e,n,o,i,p,a,d,u,l,m;for(e=r.__super__.getChanges.call(this,t),o=[],a=0,d=(u=this.properties.items).length;a<d;a++)(null!=(l=(i=u[a]).value)?l.toString():void 0)!==(null!=(m=i.model.value)?m.toString():void 0)&&(n={id:i.model.property,value:i.value},o.push(n));return e.properties=o,p=s.map(this.sampleUnits,function(t){var e;return{id:t.id,value:t.value}}),e.sampleUnits=p,e},r.prototype.loadProperties=function(t,e,n){return!n&&this.propertiesLoaded?"function"==typeof e?e(null,this.properties.items):void 0:this.loadEquipmentTemplate(null,(o=this,function(i,s){return o.propertiesLoaded=!0,s?s.loadProperties(t,function(t,n){var i;return n?(i=o.addProperties(n),"function"==typeof e?e(t,i):void 0):"function"==typeof e?e(t):void 0},n):"function"==typeof e?e(i):void 0}),n);var o},r.prototype.addProperties=function(t){var e,n,o,i,s,r;if(o=function(){var e,n,o;for(o=[],e=0,n=t.length;e<n;e++)i=t[e],o.push(i.model);return o}(),n=this.properties.addItems(o),t=this.propertyValues)for(s=0,r=n.length;s<r;s++)(e=n[s]).setValue(t[e.model.property]);return n},r.prototype.loadSignals=function(t,e,n){return!n&&this.signalsLoaded?"function"==typeof e?e(null,this.signals.items):void 0:this.loadEquipmentTemplate(null,(o=this,function(i,s){return o.signalsLoaded=!0,s?s.loadSignals(t,function(t,n){var i;return n?(i=o.addSignals(n),"function"==typeof e?e(t,i):void 0):"function"==typeof e?e(t):void 0},n):"function"==typeof e?e(i):void 0}),n);var o},r.prototype.addSignals=function(t){var e,n,o,i,s,r;for(o=function(){var e,n,o;for(o=[],e=0,n=t.length;e<n;e++)i=t[e],o.push(i.model);return o}(),s=0,r=(n=this.signals.addItems(o)).length;s<r;s++)e=n[s],this.station.signals[e.key]=e,this.project.addSignal(e);return n},r.prototype.loadEvents=function(t,e,n){return!n&&this.eventsLoaded?"function"==typeof e?e(null,this.events.items):void 0:this.loadEquipmentTemplate(null,(o=this,function(i,s){return o.eventsLoaded=!0,s?s.loadEvents(t,function(t,n){var i;return n?(i=o.addEvents(n),"function"==typeof e?e(t,i):void 0):"function"==typeof e?e(t):void 0},n):"function"==typeof e?e(i):void 0}),n);var o},r.prototype.addEvents=function(t){var e,n,o,i,s,r;for(i=function(){var n,o,i;for(i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.model);return i}(),s=0,r=(o=this.events.addItems(i)).length;s<r;s++)n=o[s],this.station.events[n.key]=n,this.project.addEvent(n);return o},r.prototype.loadCommands=function(t,e,n){return!n&&this.commandsLoaded?"function"==typeof e?e(null,this.commands.items):void 0:this.loadEquipmentTemplate(null,(o=this,function(i,s){return o.commandsLoaded=!0,s?s.loadCommands(t,function(t,n){var i;return n?(i=o.addCommands(n),"function"==typeof e?e(t,i):void 0):"function"==typeof e?e(t):void 0},n):"function"==typeof e?e(i):void 0}),n);var o},r.prototype.addCommands=function(t){var e,n,o,i,s,r;for(i=function(){var n,o,i;for(i=[],n=0,o=t.length;n<o;n++)e=t[n],i.push(e.model);return i}(),s=0,r=(o=this.commands.addItems(i)).length;s<r;s++)n=o[s],this.station.commands[n.key]=n,this.project.addCommand(n);return o},r.prototype.dispose=function(){return r.__super__.dispose.apply(this,arguments),this.signals.dispose(),this.events.dispose(),this.commands.dispose()},r}(t.ViewModel)}});