if("function"!=typeof define)var define=require("amdefine")(module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};define(["./items-base","./view-model"],function(e,t){var n,i;return{ItemsModel:n=function(e){function n(e,t){this.parent=e,n.__super__.constructor.call(this,t),this.engine=this.parent.engine,this.caches={}}return __extends(n,e),n.prototype.load=function(e,t,n,i){var o,r,s;if(r=JSON.stringify(e)+"&"+t,i&&(this.reset(),delete this.caches[r]),!(o=this.caches[r]))return o={filter:e,fields:t,callbacks:[n]},this.caches[r]=o,null==this.service&&(this.service=this.engine.modelManager.getService(this.options.id)),this.service.query(e,t,(s=this,function(e,t){var n,i,r,c,a;for(i=t&&0!==Object.keys(t).length?s.addItems(t):[],s.loaded=!0,o.loaded=!0,o.items=i,r=0,c=(a=o.callbacks).length;r<c;r++)"function"==typeof(n=a[r])&&n(e,i);return o.callbacks=[]}),i);o.loaded?"function"==typeof n&&n(null,o.items):o.callbacks.push(n)},n.prototype.loadOne=function(e,t,n,i){var o,r;return(o=this.getItemByIds(e))?o.load((r=this,function(e,t){return o=r.addItem(t),"function"==typeof n?n(e,o):void 0}),i):this.load(e,t,function(e){return function(e,t){return"function"==typeof n?n(e,null!=t?t[0]:void 0):void 0}}(this),i)},n.prototype.createItem=function(e){var n;return new t.ViewModel(this,e)},n.prototype.dispose=function(e){n.__super__.dispose.call(this,e),e||(this.cache={})},n}(e.ItemsBase)}});